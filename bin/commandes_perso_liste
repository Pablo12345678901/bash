#!/usr/bin/env bash

# Récupération de la liste de commandes possibles
declare -a LISTE_COMMANDE
OPTION_SORTIE="Quitter"
for command in $REPERTOIRE_DES_COMMANDES_PERSO/*
do
    command=${command#$REPERTOIRE_DES_COMMANDES_PERSO}
    command=${command#\/}
    LISTE_COMMANDE+=("$command")
done
LISTE_COMMANDE+=("$OPTION_SORTIE") # ajout de l'option pour quitter
DERNIERE_OPTION=${#LISTE_COMMANDE[@]}

# Sélection de la commande à exécuter avec possibilité de quitter
CHOIX=""
until [ -n "$CHOIX" ] # Boucler tant que le choix n'est pas correct = tant que choix n'est pas un string > 1char
do
    echo -e "\nChoisissez une commande pour l'exécuter ou tapez \"$DERNIERE_OPTION\" pour \"$OPTION_SORTIE\"\n"
    select CHOIX in "${LISTE_COMMANDE[@]}"
    do
        break 
    done
    if [ -n "$CHOIX" ] # si le choix est correct
    then
        if [ "$CHOIX" == "$OPTION_SORTIE" ]
        then
            echo -e "\nVous avez choisi de \"$CHOIX\" sans exécuter de commande.\n"
        else
            echo -e "\nExécution de la commande \"$CHOIX\"\n"
            exec $CHOIX || { echo -e "\nERREUR : la commande \"$CHOIX\" n'a pas fonctionné.\n" ; exit 1 ; }
        fi
    else
        echo -e "ERREUR : votre saisie ne fait pas partie de la liste de choix.\nTapez \"$DERNIERE_OPTION\" pour \"$OPTION_SORTIE\""
    fi
done