#!/usr/bin/env bash

function question_mettre_a_jour {
    local -n reponse=$1
    local QUESTION="Mettre à jour ? (Oo/Nn) "
    echo "" # esthétique
    read -p "$QUESTION" CHOIX
    case "$CHOIX" in
        [OoYy]  )   CHOIX='o';;
        [Nn]    )   CHOIX='n';;
        *       )   echo -e "\nERREUR : veuillez saisir une réponse parmi :\n\"OoYy\" pour \"Oui\"\n\"Nn\" pour \"Non\"\n" ;;
    esac
    reponse=$CHOIX
}

REPONSE='x'
while [[ $REPONSE != 'o' && $REPONSE != 'n' ]] # boucle tant que la réponse n'est pas oui ou non 
do
    question_mettre_a_jour REPONSE
done

if [ $REPONSE == 'o' ]
then
    echo -e "\nMise à jour des apps..."
    echo -e "\nBrew :\n"
    brew update &&
    brew upgrade  &&
    echo -e "\nBrew est à jour." || echo -e "\nLa mise à jour de brew n'a pas fonctionné.\n"
    echo -e "\nSoftwares :\n"
    softwareupdate -i -a && echo -e "\nLes softwares sont à jour.\n" || echo -e "\nLa mise à jour des softwares n'a pas fonctionné.\n"
else
    echo -e "\nVous avez refusé de mettre à jour les apps.\n"
fi

echo -e "Ouverture des apps...\n"
open -j -a "Finder" >&2 &
# open -j : ouvrir de manière hidden = cachée
open -a "Microsoft Excel" >&2 &
# open -g : ouvrir l'app en arrière plan - NE pas la ramener au premier plan
open -a "Microsoft Word" >&2 &
open -a "Google Chrome" >&2 &
# open -a "Firefox" >&2 &
# open -a "Activity Monitor" >&2 &
# code >&2 & # Visual Studio Code
open -a '/Applications/Visual Studio Code.app' >&2 &

sleep 3 # pour m'assurer que les autres app sont bien ouverte
# Puis remise au premier plan du terminal
open -a "Terminal" >&2


